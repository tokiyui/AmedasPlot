<!DOCTYPE html>
<html>
<head>
  <title>METARステーションデータ</title>
  <script>
    function fetchMETAR() {
      var stations = ["RJSN", "RJNT", "RJNW", "RJNK"];
      var baseUrl = "https://aviationweather.gov/cgi-bin/data/metar.cgi?ids=";

      var metarData = "";

      for (var i = 0; i < stations.length; i++) {
        var url = baseUrl + stations[i];

        var proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent(url);

        fetch(proxyUrl)
          .then(response => response.json())
          .then(data => {
            // JSONデータからメタデータを取得
            var responseText = data.contents;
            var parser = new DOMParser();
            var xmlDoc = parser.parseFromString(responseText, "text/html");
            var metar = xmlDoc.querySelector("code").textContent;

            // METARデータを取得した後の処理
            metarData += "<h2>" + stations[i] + "</h2>";
            metarData += "<pre>" + metar + "</pre>";

            if (i === stations.length - 1) {
              // 最後のステーションのデータを取得した後、HTMLに表示
              document.getElementById("metarContainer").innerHTML = metarData;
            }
          })
          .catch(error => {
            // エラーハンドリング
            console.log("エラーが発生しました:", error);
          });
      }
    }
  </script>
</head>
<body>
  <button onclick="fetchMETAR()">METARデータを取得</button>
  <div id="metarContainer"></div>
</body>
</html>
